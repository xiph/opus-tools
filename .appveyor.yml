image: Visual Studio 2015
configuration:
- Debug
- Release

platform:
- Win32
- x64

install:
- cd %APPVEYOR_BUILD_FOLDER%
- git clone -q https://github.com/xiph/opus.git ..\opus
- git clone -q https://github.com/xiph/ogg.git ..\ogg
- msbuild "..\opus\win32\VS2015\opus.vcxproj" /p:Configuration=%CONFIGURATION%;Platform=%PLATFORM% /m /v:minimal /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll"
- msbuild "..\ogg\win32\VS2015\libogg_static.sln" /property:Configuration=%CONFIGURATION%;Platform=%PLATFORM% /m /v:minimal /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll"

build:
  project: win32\VS2015\opus-tools.sln
  parallel: true
  verbosity: minimal

after_build:
  - cd %APPVEYOR_BUILD_FOLDER%
  - copy /Y COPYING LICENSE
  - 7z a opus-tools.zip .\win32\VS2015\%PLATFORM%\%CONFIGURATION%\*.exe .\LICENSE
  - for %%a in (enc dec info) do curl -O https://mf4.xiph.org/jenkins/view/opus/job/opus-tools/ws/man/opus%%a.html
  - 7z a opus-tools.zip .\opusenc.html .\opusdec.html .\opusinfo.html

artifacts:
  - path: opus-tools.zip

